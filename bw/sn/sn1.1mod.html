<!DOCTYPE html>
<html lang="en">
<head>
 	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 	<link rel="icon" type="image/x-icon" href="../images/favicon.ico">
 	<title>Samyutta Nikāya - Connected Discourses with Devatas 1.1</title>
 	<meta name="viewport" content="width=device-width, initial-scale=1">
 	<!-- Loading third party fonts -->
 	<link href="../fonts/font-awesome.min.css" rel="stylesheet" type="text/css">
 	<!-- Loading main and menu stylesheets -->
 	<link rel="stylesheet" href="../css/w3.css">
 	<link rel="stylesheet" href="../css/css.css">
 	<link rel="stylesheet" href="../css/menu.css">
<style>
  
  

    /* Стили для обычного текста */
    .pli-lang {
      cursor: text; 
      color: inherit; 
    }

    /* Стили для popup */
    .popup {
   /*    
   position: fixed;
top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 80%;
      */
background: white; 
      border: 2px solid #666;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      z-index: 100000;
      display: none;
    }

/* Темный режим для popup */
.popup.dark {
  background: black; /* Черный фон для темного режима */
  color: white;      /* Белый текст */
  border-color: #666; /* Более темная рамка */
}

[data-theme="dark"] .popup iframe {
  background: black;
}

    .popup iframe {
      width: 100%;
      height: 100%;
      border: none;
            z-index: 10000;
    }

    .popup.dark  {
background: black;
    }

.popup-header {
  background = 'white';
}
  
[data-theme="dark"] .popup-header {
  background: black;
}

.popup-header.dark {
  background = black;
}

.popup .close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #CE0520;
  color: #e1dede;
  border: none;
  height: 30px;
  width: 30px;
  cursor: pointer;
  border-radius: 100%; /* делает кнопку круглой */
}

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }

.common-size-icon4 {
  height: 25px; 
  width: 22px;
}

.dictIcon {
height:15px; 
width:15px;
}

.dictIcon-sitePages {
height: 35px; 
width: 35px;
}


/* Базовый стиль для иконки */
.toggle-dict-btn img {
  width: 24px;
  height: 24px;
}

/* Для конкретного контейнера */
.container-fluid .toggle-dict-btn img {
  width: 20px;
  height: 20px;
}

/* Использование атрибута */
img[data-size="small"] {
  width: 16px;
  height: 16px;
}

img[data-size="large"] {
  width: 48px;
  height: 48px;
}


/*$
<button class="btn btn-light mb-1 toggle-dict-btn" type="button">
  <img src="/assets/svg/comment.svg" data-size="small">
</button>

<button class="btn btn-light mb-1 toggle-dict-btn" type="button">
  <img src="/assets/svg/comment.svg" data-size="large">
</button>

*/



  
</style>
 	<script src="../js/jquery-1.10.2.min.js"></script>
 	<script src="../js/controlpanel.js"></script>
 	<script src="../js/mousetrap.min.js"></script>
 </head>
 <body class="container">
 <div class="header-background">
 <!-- Header -->
 <div class="w3-header w3-content w3-padding w3-left-align bwcontainer">
 	<div class="centered">
 		<button class="light-mode-button" aria-label="Toggle Light Mode" onclick="toggle_light_mode()">
 			<span></span>
 			<span></span>
 		</button>
 		<span class="box-lbl">Light/Dark</span>
 	</div> <!-- Centered -->
 		<a href="../home/index.html" id="bwlogo"><img src="../images/headerlogo.png" alt="The Buddha's Words logo" class="w3-image"></a>
 		<div class="w3-bar bwcontainer">
 			<div id="searchlinks">
 			<a href="../home/engsearch.html"><span class="w3-bar-item"><i class="fa fa-search"></i>&nbsp;Search English</span></a>
 			<a href="../home/palisearch.html"><span class="w3-bar-item"><i class="fa fa-search"></i>&nbsp;Search Pali</span></a>
 			</div><!-- End Searchlinks div -->
 			<div class="help"><span><a href="../home/help.html"><img src="../images/help_icon.png" title="Help" alt="Help"></a></span></div>
 		</div> <!-- End w3-bar bwcontainer --> 	</div> <!-- End w3-header w3-content w3-padding w3-left-align bwcontainer -->
 </div> <!-- End header-background -->
 <!-- Top menu -->

 <div class="w3-main w3-white bwcontainer2">
 	<div class="w3-button w3-padding-8 w3-left w3-hide-large" onclick="w3_open()"><i class="fa fa-bars fa-lg"></i>&nbsp;</div>
 		<div id="navbar" class="w3-hide-small w3-hide-medium bwcontainer3">
 			<ul id="css3menu0">
 				<li class="topfirst" id="home"><a href="../home/index.html" class="w3-hide-small">Home</a></li>
			<li class="topmenu" id="dn"><a href="../dn/dn.html" class="w3-hide-small">Dīgha Nikāya</a></li>
 				<li class="topmenu" id="mn"><a href="../mn/mn.html" class="w3-hide-small">Majjhima Nikāya</a></li>
 				<li class="topmenu" id="sn"><a href="../sn/sn.html" class="pressed w3-hide-small"><i class="fa fa-caret-down"></i>&nbsp;Saṁyutta Nikāya</a>
 					<ul>
 						<li><a href="../sn/sn01.html" class="pressed w3-hide-small">Vol. 1 ‒ The Book with Verses</a></li>
 						<li><a href="../sn/sn02.html" class="w3-hide-small">Vol. 2 ‒ The Book of Causation</a></li>
 						<li><a href="../sn/sn03.html" class="w3-hide-small">Vol. 3 ‒ The Book of the Aggregates</a></li>
 						<li><a href="../sn/sn04.html" class="w3-hide-small">Vol. 4 ‒ The Book of the Six Sense Bases</a></li>
 						<li><a href="../sn/sn05.html" class="w3-hide-small">Vol. 5 ‒ The Great Book</a></li>
 					</ul>
 				<li class="topmenu" id="an"><a href="../an/an.html" class="w3-hide-small"><i class="fa fa-caret-down"></i>&nbsp;Aṅguttara Nikāya</a>
 					<ul>
 						<li><a href="../an/an1.html" class="w3-hide-small">The Ones</a></li>
 						<li><a href="../an/an2.html" class="w3-hide-small">The Twos</a></li>
 						<li><a href="../an/an3.html" class="w3-hide-small">The Threes</a></li>
 						<li><a href="../an/an4.html" class="w3-hide-small">The Fours</a></li>
 						<li><a href="../an/an5.html" class="w3-hide-small">The Fives</a></li>
 						<li><a href="../an/an6.html" class="w3-hide-small">The Sixes</a></li>
 						<li><a href="../an/an7.html" class="w3-hide-small">The Sevens</a></li>
 						<li><a href="../an/an8.html" class="w3-hide-small">The Eights</a></li>
 						<li><a href="../an/an9.html" class="w3-hide-small">The Nines</a></li>
 						<li><a href="../an/an10.html" class="w3-hide-small">The Tens</a></li>
 						<li><a href="../an/an11.html" class="w3-hide-small">The Elevens</a></li>
 					</ul>
 				</li>
 				<li class="topmenu" id="kn"><a href="../kn/kn.html" class="w3-hide-small"><i class="fa fa-caret-down"></i>&nbsp;Khuddaka Nikāya</a>
 					<ul>
 						<li><a href="../kp/kp.html" class="w3-hide-small">The Khuddakapatha</a></li>
 						<li><a href="../dhp/dhp.html" class="w3-hide-small">The Dhammapada</a></li>
 						<li><a href="../snp/snp.html" class="w3-hide-small">Sutta Nipata</a></li>
 						<li><a href="../ud/ud.html" class="w3-hide-small">Udana</a></li>
 						<li><a href="../it/it.html" class="w3-hide-small">Itivuttaka</a></li>
 						<li><a href="../tha/tha.html" class="w3-hide-small">The Theragatha</a></li>
 						<li><a href="../thi/thi.html" class="w3-hide-small">The Therigatha</a></li>
 					</ul>
 				</li>
 				<li class="toplast" id="vi"><a href="../vi/vi.html" class="w3-hide-small"><i class="fa fa-caret-down"></i>&nbsp;Vinaya Piṭaka</a>
 					<ul>
 						<li><a href="../vi/kd.html" class="w3-hide-small">Khandhaka</a></li>
 						<li><a href="../vi/bu-vb.html" class="w3-hide-small">Bhikkhu Vibhaṅga</a></li>
 						<li><a href="../vi/bu-pt.html" class="w3-hide-small">Bhikkhu Pāṭimokkha</a></li>
 						<li><a href="../vi/bi-pt.html" class="w3-hide-small">Bhikkhunī Pāṭimokkha</a></li>
 						<li><a href="../vi/bi-vb.html" class="w3-hide-small">Bhikkhunī Vibhaṅga</a></li>
 					</ul>
 				</li>
 			</ul>
 			</div>
 		</div> <!--navbar-->

<!-- Sidebar (hidden by default) -->
 <nav class="w3-sidebar w3-bar-block w3-card w3-border w3-top w3-animate-left w3-hide-large" id="mySidebar">
 	<a href="javascript:void(0)" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-times fa-2x red-color"></i>&nbsp;&nbsp;&nbsp;Close</a><!-- Hides the sidebar when clicked --> 		<div class="w3-bar-block w3-white">
 			<a href="../home/index.html" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-home fa-lg"></i>&nbsp;&nbsp;Home</a>
 			
 			<a href="../guide/guide.html#content" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-book"></i>&nbsp;&nbsp;Guide</a>
 			<a href="../dn/dn.html#content" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-book"></i>&nbsp;&nbsp;Dīgha Nikāya</a>
 			<a href="../mn/mn.html#content" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-book"></i>&nbsp;&nbsp;Majjhima Nikāya</a>
 			<a href="../sn/sn.html#content" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-book"></i>&nbsp;&nbsp;Saṁyutta Nikāya</a>
 			<a href="../an/an.html#content" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-book"></i>&nbsp;&nbsp;Aṅguttara Nikāya</a>
 			<a href="../kn/kn.html#content" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-book"></i>&nbsp;&nbsp;Khuddaka Nikāya</a>
 			<a href="../vi/vi.html#content" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-yellow"><i class="fa fa-book"></i>&nbsp;&nbsp;Vinaya Piṭaka</a>
 		</div>
 </nav>
 
 
 
<!-- !PAGE DIV! --> <!-- Div for page content -->
  	<div class="w3-main w3-content w3-padding w3-left-align bwcontainer4">
 	<h2 id="SN01heading">Saṁyutta Nikāya — The Connected Discourses</h2>
  
 				
<h3 id="SN1heading">SN1: Connected Discourses with Devatas</h3>

		

 <!--      SN content begins here      -->
  
 <div id="content">


<h3>SN1:1 Crossing the Flood</h3>

<div id="metaarea">
 <ul class="translator">
 <li><a href="/ru/read/?q=sn1.1">dg</a> <a href="https://suttacentral.net/sn1.1">sc</a> &copy;&nbsp;Translated from the Pali by Bhikkhu Bodhi.&nbsp;
 <a href="../home/copyright.html#wp">(More copyright information)</a>
 </li>
 </ul>
 </div>

<section class="raw_sutta">  <!-- English and Pali -->
<div lang="en">

<p id="p1"><span class="parno">1</span>Thus have I heard. On one occasion the Blessed One was dwelling at Sāvatthī in Jeta's Grove, Anāthapiṇḍika's Park. Then, when the night had advanced, a certain devata of stunning beauty, illuminating the entire Jeta's Grove, approached the Blessed One. Having approached, he paid homage to the Blessed One, stood to one side, and said to him:</p>

<hr>
<p>"How, dear sir, did you cross the flood?"<span class="note" id="n1"><span class="details"><span class="p">[n.1] <i>Mārisa,</i> "dear sir," is the term which the devas generally use to address the Buddha, eminent bhikkhus (e.g. see the Pali for <a href="sn40.10.html#3">SN40:10</a>), and members of their own community (<a href="sn11.3.html#3">SN11.3</a>); kings also use it to address one another (<a href="sn3.12.html">SN3.12</a>). <a href="sn0-abbr.html" title="Abbreviations">Spk</a> explains it as a term of affection meaning "one without suffering" <i>(niddukkha)</i>, but it is probably a Middle Indic form of Skt madṛsa. The word "flood" <i>(ogha)</i> is used metaphorically, but here with technical overtones, to designate a doctrinal set of four floods (see <a href="sn45.171.html">SN45.171</a>), so called, according to Spk, "because they keep beings submerged within the round of existence and do not allow them to rise up to higher states and to Nibbāna." The four (with definitions from Spk) are: (i) the flood of sensuality <i>(kāmogha)</i> = desire and lust for the five cords of sensual pleasure (agreeable forms, sounds, etc.—see <a href="sn45.176.html">SN45.176</a>); (ii) the flood of existence <i>(bhavogha)</i> = desire and lust for form-sphere existence and formless-sphere existence and attachment to jhāna; (iii) theflood of views <i>(diṭṭhogha)</i> = the sixty-two views (<a href="../dn/dn1.html">DN I</a>); and (iv) the flood of ignorance <i>(avijjogha)</i> = lack of knowledge regarding the Four Noble Truths.</span></span></span></p>

<p>"By not halting, friend, and by not straining I crossed the flood."<span class="note" id="n2"><span class="details"><span class="p">[n.2] <i>Appatiṭṭhaṁ khvahaṁ āvuso anayūhaṁ ogham atariṁ.</i> Spk: The Buddha’s reply is intended to be paradoxical, for one normally crosses a flood by halting in places that offer a foothold and by straining in places that must be crossed.

<br class="half"><a href="sn0-abbr.html" title="Abbreviations">Spk</a> glosses <i>appatiṭṭhaṁ</i> only with <i>appatiṭṭhahanto</i> (an alternative form of the present participle), but Spk-pṭ elaborates: "Not halting: not coming to a standstill on account of the defilements and so forth; the meaning is ‘not sinking’ <i>(appatiṭṭhahanto ti kilesādīnaṁ vasena asantiṭṭhanto, asaṁsīdanto ti attho)</i>." The verb <i>patitiṭṭhati</i> usually means "to become established," i.e., attached, principally on account of craving and other defilements. Consciousness driven by craving is "established" (see <a href="sn12.38.html">SN12.38–40</a>, <a href="sn12.12.html">SN12.12</a>,<a href="sn22.53.html">SN22.53–54</a>), and when craving is removed it becomes "unestablished, unsupported." The arahant expires "with consciousness unestablished" (appatiṭṭhitena viññāṇena … parinibbuto; see <a href="sn4.23.html">SN4.23</a>). All these nuances resonate in the Buddha’s reply.</span>

<br class="half"><span class="p">The verb <i>ayūhati</i> is rare in the Nikāyas, but see below v. <a href="sn2.5.html#p3">263df</a>, v.&nbsp;264d, and <a href="../snp/snp1.12.html#p210">Sn 210d</a>. It is an intensification of <i>ūhati</i> (augmented by <i>a-</i> with <i>-y-</i> as liaison); the simple verb occurs at <a href="../mn/mn19.html#p6">MN19 verses 6, 7 and 15,</a> where it might be rendered "to be strained." Its occurrence there ties up with the present context: a strained mind is far from concentration. In the later literature the noun form <i>ayūhana</i> acquires the technical sense of "accumulation," with specific reference to kamma; in the formula of dependent origination <i>(paṭiccasamuppāda)</i>, volitional formations <i>(saṅkhāra)</i> are said to have the function of <i>ayūhana;</i> see&nbsp;Paṭis I 52,14, 26; Vism 528,12 (Ppn 17:51), 579,31–580,4 (Ppn 17:292–93).</span>

<br class="half"><span class="p"><a href="sn0-abbr.html" title="Abbreviations">Spk</a>: The Blessed One deliberately gave an obscure reply to the deva in order to humble him, for he was stiff with conceit yet imagined himself wise. Realizing that the deva would not be able to penetrate the teaching unless he first changed his attitude, the Buddha intended to perplex him and thereby curb his pride. At that point, humbled, the deva would ask for clarification and the Buddha would explain in such a way that he could understand.</span></span></span></p>

<p>"But how is it, dear sir, that by not halting and by not straining you crossed the flood?"</p>

<p>"When I came to a standstill, friend, then I sank; but when I struggled, then I got swept away. It is in this way, friend, that by not halting and by not straining I crossed the flood."<span class="note" id="n3"><span class="details"><span class="p">[n.3] The Buddha’s brief reply points to the middle way <i>(majjhimā paṭipadā)</i> in its most comprehensive raṅge, both practical and philosophical. To make this implication clear <a href="sn0-abbr.html" title="Abbreviations">Spk</a> enumerates seven dyads: (i) "halting" by way of defilements, one sinks; "straining" by way of volitional formations, one gets swept away; (ii) by way of craving and views, one sinks; by way of the other defilements, one gets swept away; (iii) by way of craving, one sinks; by way of views, one gets swept away; (iv) by way of the eternalist view, one sinks; by way of the annihilationist view, one gets swept away (see <a href="../it/it.html#i43">It&nbsp;43,12–44,4</a>); (v) by way of slackness one sinks, by way of restlessness one gets swept away; (vi) by way of devotion to sensual pleasures one sinks, by way of devotion to self-mortification one gets swept away; (vii) by way of all unwholesome volitional formations one sinks, by way of all mundane wholesome volitional formations one gets swept away. ñāṇananda suggests connecting the principle of "not halting, not straining" with each of the four floods: see SN-Anth 2:56–58.</span></span></span></p>

<p><span class="add">The devata:</span></p>

<hr>
<p class="verse" id="p2"><span class="parno" id="v1">2</span><span class="add">v.1</span> "After a long time at last I see
<br>A brahmin who is fully quenched,
<br>Who by not halting, not straining,
<br>Has crossed over attachment to the world."<span class="note" id="n4"><span class="details"><span class="p">[n.4] <a href="sn0-abbr.html" title="Abbreviations">Spk</a>: The Buddha is called a brahmin in the sense of arahant (see <a href="../dhp/dhp383-423.html#388">Dhp 388</a>, <a href="../dhp/dhp383-423.html#396">396–423</a>). He is <i>fully quenched</i> <i>(parinibbuto)</i> in that he is quenched through the quenching of defilements <i>(kilesanibbanena nibbutaṁ)</i>. Craving is designated <i>attachment</i> <i>(visattika)</i> because it clings and adheres to a variety of sense objects.</span></span></span></p>

<p id="p3"><span class="parno">3</span>This is what that devata said.<span class="note" id="n5"><span class="details"><span class="p">[n.5] <a href="sn0-abbr.html" title="Abbreviations">Spk</a>: When the deva heard the Buddha’s reply he was established in the fruit of stream-entry.</span></span></span> The Teacher approved. Then that devata, thinking, "The Teacher has approved of me," paid homage to the Blessed One and, keeping him on the right, disappeared right there. <a class="pts_pn">sn.i.2</a></p>

</div>
<div lang="pi">

<p><span class="parno">1</span><span class="evam">Evaṁ me sutaṁ—​</span>  ekaṁ samayaṁ bhagavā sāvatthiyaṁ vihārati jetavane anāthapiṇḍikassa ārāme. Atha kho aññatarā devatā abhikkantāya rattiyā abhikkantavaṇṇā kevalakappaṁ jetavanaṁ obhāsetvā yena bhagavā tenupasaṅkami; upasaṅkamitvā bhagavantaṁ abhivādetvā ekamantaṁ aṭṭhāsi. Ekamantaṁ ṭhitā kho sā devatā bhagavantaṁ etadavoca: </p>

<hr>
<p>"Kathaṁ nu tvaṁ, mārisa, oghamatarī"ti? </p>

<p>"Appatiṭṭhaṁ khvāhaṁ, āvuso, anāyūhaṁ oghamatarin"ti. </p>

<p>"Yathākathaṁ pana tvaṁ, mārisa, appatiṭṭhaṁ anāyūhaṁ oghamatarī"ti? </p>

<p>"Yadāsvāhaṁ, āvuso, santiṭṭhāmi tadāssu saṁsīdāmi; yadāsvāhaṁ, āvuso, āyūhāmi tadāssu nibbuyhāmi. Evaṁ khvāhaṁ, āvuso, appatiṭṭhaṁ anāyūhaṁ oghamatarin"ti.</p>

<hr>
<p class="verse"><span class="parno">2</span>"Cirassaṁ vata passāmi,
<br>brāhmaṇaṁ parinibbutaṁ;
<br>Appatiṭṭhaṁ anāyūhaṁ,
<br>tiṇṇaṁ loke visattikan"ti.</p>

<p><span class="parno">3</span>Idamavoca sā devatā. Samanuñño satthā ahosi. Atha kho sā devatā: "samanuñño me satthā"ti bhagavantaṁ abhivādetvā padakkhiṇaṁ katvā tatthevantaradhāyīti.</p>
</div>
</section>  <!-- End English and Pali -->
<div id="nextprev"><a id="previous-sutta" href="./sn1.html#content"></a><a id="next-sutta" href="./sn1.2.html#content"></a></div>
</div>  <!--End Content -->
</div>  <!-- End Page -->
<div class="w3-white bwcontainer2"> <!-- Footer div -->
<!-- Footer -->
		<footer>
		    <a alt="onclick popup dictionary" class="common-size-icon4 toggle-dict-btn text-decoration-none text-black">  <img src="/assets/svg/comment.svg" class="dictIcon"></img></a> 

			<div id="breadcrumbs"><a href="../home/index.html">Home</a><a href="sn.html">Saṁyutta Nikāya</a><a href="sn1.html">Linked Discourses with Devatas</a> SN 1.1: Crossing the Flood </div>
					<div class="bottomlinks">
 	<a href="../guide/guide.html"><span class="w3-bar-item"><i class="fa fa-compass"></i>&nbsp;Guide</span></a>
 	 	<a href="../home/help.html"><span class="w3-bar-item"><i class="fa fa-info"></i>&nbsp;Help</span></a>
 	<a href="../home/crossreference.html"><span class="w3-bar-item"><i class="fa fa-exchange"></i>&nbsp;Links&nbsp;Cross&nbsp;Reference</span></a>
 	<a href="../home/copyright.html"><span class="w3-bar-item">&copy;&nbsp;Copyright</span></a>
 	<a href="../home/contact.html"><span class="w3-bar-item"><i class="fa fa-envelope"></i>&nbsp;Contact</span></a>
 </div>  <!-- End bottom links -->
</footer>
 </div>
 
 <!-- Scripts -->

<script>
 // Script to turn Pali Lookup on and off
 function togPaliLookup() {
 		var checkBox = document.getElementById("myCheck");
 		var text = document.getElementById("text");
 		if (checkBox.checked == true){
 				text.style.display = "block";
 					} else {
 							text.style.display = "none";
 		}
 }
 </script>

 <script>
 // Script to open and close sidebar
 	function w3_open() {
 	document.getElementById("mySidebar").style.display = "block";
 	}
 		function w3_close() {
 		document.getElementById("mySidebar").style.display = "none";
 	}
 </script>
 <script>
 		var app = document.getElementsByTagName("BODY")[0];
 		if (localStorage.lightMode == "dark") {
 			app.setAttribute("light-mode", "dark");
 	}
 </script>
 
 <script>
 		function toggle_light_mode() {
 			var app = document.getElementsByTagName("BODY")[0];
 				if (localStorage.lightMode == "dark") {
 			localStorage.lightMode = "light";
 			app.setAttribute("light-mode", "light");
 		} else {
 					localStorage.lightMode = "dark";
 					app.setAttribute("light-mode", "dark");
 	}
 		}
 
 		window.addEventListener("storage", function () {
 			if (localStorage.lightMode == "dark") {
 				app.setAttribute("light-mode", "dark");
 				} else {
 				app.setAttribute("light-mode", "light");
 		}
 		}, false);
 
 </script>
 <script src="../js/footer.js"></script><script src="../js/dpd_deconstructor.js"></script><script src="../js/dpd_ebts.js"></script><script src="../js/dpd_i2h.js"></script>
 <script src="/sw.js"></script>
 
 <script>
   
// Проверяем язык в localStorage
const siteLanguage = localStorage.getItem('siteLanguage');
const savedDict = (localStorage.getItem('selectedDict') || "dpdFull").toLowerCase();
  // Устанавливаем правильный URL для словаря в зависимости от языка
let dhammaGift;
let dgParams;
let dictUrl;


/*
// Условие для проверки языка сайта и URL
if (window.location.href.includes('/ru/') || window.location.href.includes('ml.html')) {
 //dhammaGift = 'https://dhamma.gift/ru/';
 dhammaGift = '/ru/';
  //dictUrl = 'http://localhost:8080/ru/';
 dictUrl = 'https://dict.dhamma.gift/ru/search_html?q=';
  //dictUrl = 'https://dpdict.net/ru/search_html?q=';
} else {
//   dhammaGift = 'https://dhamma.gift/';
   dhammaGift = '/';
  //dictUrl = 'http://localhost:8080/';
  dictUrl = 'https://dict.dhamma.gift/search_html?q=';
//  dictUrl = 'https://dpdict.net/search_html?q=';
}

if (window.location.href.includes('localhost') || window.location.href.includes('127.0.0.1')) {
  dictUrl = 'dttp://app.dicttango/WordLookup?word=';
}
*/

if (window.location.href.includes('localhost') || window.location.href.includes('127.0.0.1')) {
    dhammaGift = '';
} else {
    dhammaGift = 'https://dhamma.gift';
}

  if (window.location.href.includes('/ru') || (localStorage.siteLanguage && localStorage.siteLanguage === 'ru')) {
   dhammaGift += '/ru';
}
 dhammaGift += '/?q=';

//добавить сюда логику для загрузки предпочтений поиска сохраненных на главной.
dgParams = '&p=-kn';


if (savedDict.includes("dpd")) {
  dictUrl = "https://dict.dhamma.gift";
  if (savedDict.includes("ru")) {
    dictUrl += "/ru";
  }
  
  if (savedDict.includes("full")) {
    dictUrl += "/search_html?q=";
  } else if (savedDict.includes("compact")) {
    dictUrl += "/gd?search=";
  }
} else if (savedDict === "dicttango") {
  dictUrl = "dttp://app.dicttango/WordLookup?word=";
} else {
   dictUrl = "searchonly";
}



function clearParams() {
    const keys = ['popupWidth', 'popupHeight', 'popupTop', 'popupLeft', 'windowWidth', 'windowHeight', 'isFirstDrag'];
    keys.forEach(key => localStorage.removeItem(key));
}

// Создание элементов для Popup с возможностью изменения размера и перемещения
function createPopup() {
  const overlay = document.createElement('div');
  overlay.classList.add('overlay');

  const popup = document.createElement('div');
  popup.classList.add('popup');
  popup.style.position = 'fixed';
  popup.style.maxWidth = '600px';

  

  // Проверка параметров окна браузера
  const currentWindowWidth = window.innerWidth;
  const currentWindowHeight = window.innerHeight;

  const savedWindowWidth = localStorage.getItem('windowWidth');
  const savedWindowHeight = localStorage.getItem('windowHeight');

  // Если размеры окна изменились, очищаем сохраненные данные popup
  if (
    savedWindowWidth &&
    savedWindowHeight &&
    (parseInt(savedWindowWidth, 10) !== currentWindowWidth ||
      parseInt(savedWindowHeight, 10) !== currentWindowHeight)
  ) {
clearParams();
  }

  // Сохраняем текущие размеры окна
  localStorage.setItem('windowWidth', currentWindowWidth);
  localStorage.setItem('windowHeight', currentWindowHeight);

  // Устанавливаем сохранённые размеры и позицию, если они есть
  

  
  const savedWidth = localStorage.getItem('popupWidth');
  const savedHeight = localStorage.getItem('popupHeight');
  const savedTop = localStorage.getItem('popupTop');
  const savedLeft = localStorage.getItem('popupLeft');
 
  
console.log('loaded: ' + savedTop +  'and ' + savedLeft);

  if (savedWidth) popup.style.width = savedWidth;
  if (savedHeight) popup.style.height = savedHeight;
  if (savedTop) popup.style.top = savedTop;
  if (savedLeft) 
  {
    popup.style.left = savedLeft;
  } 
  
  const closeBtn = document.createElement('button');
  closeBtn.classList.add('close-btn');
  closeBtn.innerHTML = '<img src="/assets/svg/xmark.svg" class=""></img>';

// Создаем кнопку "Search with dhamma.gift"
const openBtn = document.createElement('a');
openBtn.classList.add('open-btn');
openBtn.style.position = 'absolute';
openBtn.style.top = '10px';
openBtn.style.right = '45px'; // Располагаем справа от кнопки закрытия
openBtn.style.border = 'none';
openBtn.style.background = '#2D3E50';
openBtn.style.color = 'white';
openBtn.style.cursor = 'pointer';
openBtn.style.width = '30px';
openBtn.style.height = '30px';
openBtn.style.borderRadius = '50%';
openBtn.style.display = 'flex';
openBtn.style.alignItems = 'center';
openBtn.style.justifyContent = 'center';
openBtn.style.textDecoration = 'none';
openBtn.target = '_blank'; // Открывать ссылку в новой вкладке

// Иконка лупы (аналогичная иконке закрытия)
openBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="white" style="transform: scaleX(-1);">
        <path d="M505 442.7l-99.7-99.7c28.4-35.3 45.7-79.8 45.7-128C451 98.8 352.2 0 224 0S-3 98.8-3 224s98.8 224 224 224c48.2 0 92.7-17.3 128-45.7l99.7 99.7c6.2 6.2 14.4 9.4 22.6 9.4s16.4-3.1 22.6-9.4c12.5-12.5 12.5-32.8 0-45.3zM224 384c-88.4 0-160-71.6-160-160S135.6 64 224 64s160 71.6 160 160-71.6 160-160 160z"/>
    </svg>
`;


  const iframe = document.createElement('iframe');
  iframe.src = '';
  iframe.style.width = '100%';
  iframe.style.height = 'calc(100%)'; // Оставляем место для заголовка

  // Добавляем заголовок для перетаскивания
  const header = document.createElement('div');
  header.classList.add('popup-header');
  header.style.cursor = 'move';
  header.style.height = '10px';
  header.style.display = 'flex';
  header.style.alignItems = 'center';
  header.style.padding = '0 10px';
  header.textContent = '';

  popup.appendChild(header);
  popup.appendChild(openBtn);
  popup.appendChild(closeBtn);
  popup.appendChild(iframe);

  // Добавляем popup и overlay на страницу
  document.body.appendChild(overlay);
  document.body.appendChild(popup);

  // Функция для сохранения позиции и размеров
  function savePopupState() {
    localStorage.setItem('popupWidth', popup.style.width);
    localStorage.setItem('popupHeight', popup.style.height);
    localStorage.setItem('popupTop', popup.style.top);
    localStorage.setItem('popupLeft', popup.style.left);
    console.log('savedstates');
  }

  // Перетаскивание окна
  let isDragging = false;
  let startX, startY, initialLeft, initialTop;
let isFirstDrag = localStorage.getItem('isFirstDrag') === 'false' ? false : true;

    if (isFirstDrag) {
      popup.style.top = '50%';
  popup.style.left = '50%';
  popup.style.width = '80%';
  popup.style.maxWidth = '600px';
  popup.style.height = '80%';
  popup.style.transform = 'translate(-50%, -50%)';
}

  // Обработчик нажатия для мыши (десктоп)
  function startDrag(e) {
    isDragging = true;
    
      // Добавить этот блок для первого перемещения
    if (isFirstDrag) {
      const rect = popup.getBoundingClientRect();
      popup.style.transform = 'none';  // убираем transform, который центрирует окно
      popup.style.top = rect.top + 'px';
      popup.style.left = rect.left + 'px';
      isFirstDrag = false;
    // Сохраняем состояние isFirstDrag в sessionStorage
    localStorage.setItem('isFirstDrag', isFirstDrag);
    }  
   
    
    startX = e.clientX || e.touches[0].clientX; // Поддержка сенсорных устройств
    startY = e.clientY || e.touches[0].clientY;
    initialLeft = parseInt(popup.style.left || 0, 10);
    initialTop = parseInt(popup.style.top || 0, 10);
    e.preventDefault();
  }

  // Обработчик перемещения для мыши (десктоп)
function moveDrag(e) {
    if (isDragging) {
      const deltaX = (e.clientX || e.touches[0].clientX) - startX;
      const deltaY = (e.clientY || e.touches[0].clientY) - startY;
      popup.style.left = `${initialLeft + deltaX}px`;
      popup.style.top = `${initialTop + deltaY}px`;
    }
  }

  // Обработчик окончания перетаскивания для мыши (десктоп)
  function stopDrag() {
    if (isDragging) {
      isDragging = false;
      savePopupState();
    }
  }

  // Обработчики для перетаскивания на десктопе
  header.addEventListener('mousedown', startDrag);
  document.addEventListener('mousemove', moveDrag);
  document.addEventListener('mouseup', stopDrag);

  // Обработчики для перетаскивания на мобильных устройствах
  header.addEventListener('touchstart', startDrag);
  document.addEventListener('touchmove', moveDrag);
  document.addEventListener('touchend', stopDrag);

  // Изменение размеров окна
  popup.style.resize = 'both';
  popup.style.overflow = 'auto';

  const resizeObserver = new ResizeObserver(() => {
    savePopupState();
  });
  resizeObserver.observe(popup);

  return { overlay, popup, closeBtn, iframe };
}

// Вставка popup на страницу
const { overlay, popup, closeBtn, iframe } = createPopup();

// Закрытие popup при нажатии на кнопку или на overlay
closeBtn.addEventListener('click', () => {
      event.stopPropagation(); // Останавливаем всплытие события

  popup.style.display = 'none';
  overlay.style.display = 'none';
  iframe.src = ''; // Очищаем iframe
//  resizeObserver.disconnect();
});

overlay.addEventListener('click', () => {
      event.stopPropagation(); // Останавливаем всплытие события

  popup.style.display = 'none';
  overlay.style.display = 'none';
  iframe.src = ''; // Очищаем iframe
});

console.log('lookup dict ', dictUrl, ' siteLanguage ', siteLanguage);

// Проверяем состояние в localStorage при загрузке страницы
let dictionaryVisible = localStorage.getItem('dictionaryVisible') === 'true';

const toggleBtn = document.querySelector('.toggle-dict-btn');
if (dictionaryVisible) {
  toggleBtn.innerHTML = '<img src="/assets/svg/comment.svg"></img>';
} else {
  toggleBtn.innerHTML = '<img src="/assets/svg/comment-slash.svg"></img>';
  clearParams();
}

// Обработчик кнопки для включения/выключения отображения словаря
toggleBtn.addEventListener('click', () => {
  dictionaryVisible = !dictionaryVisible;

  // Сохраняем состояние в localStorage
  localStorage.setItem('dictionaryVisible', dictionaryVisible);

  if (dictionaryVisible) {
    toggleBtn.innerHTML = '<img src="/assets/svg/comment.svg"></img>';
  } else {
    toggleBtn.innerHTML = '<img src="/assets/svg/comment-slash.svg"></img>';
  }
});

    // Добавляем обработчик сочетания клавиш Alt + A (физическая клавиша)
  document.addEventListener("keydown", (event) => {
    if (event.altKey && event.code === "KeyA") {
      // Имитируем клик по кнопке
      toggleBtn.click();
    }
  });  

// Перехватчик кликов по слову
document.addEventListener('click', function(event) {
    // Проверяем, что клик был по элементу с классом "pli-lang"


if (event.target.closest('.pli-lang, .rus-lang, .eng-lang, [lang="pi"], [lang="en"], [lang="ru"]')) {  // Учитываем вложенные элементы
        const clickedWord = getClickedWordWithHTML(event.target, event.clientX, event.clientY);
        
                // Если клик был по ссылке <a>, ничего не делаем
if (event.target.closest('a, button, input, textarea, select')) {
    return;
}

        if (clickedWord) {
            // Убираем кавычки или апострофы в начале слова
            const cleanedWord = cleanWord(clickedWord);
            console.log('Клик по слову:', cleanedWord);

            if (dictionaryVisible) {
//   use  /gd?search= for xompact mode
//     const url = `${dictUrl}gd?search=${encodeURIComponent(cleanedWord)}`;

function showSearchButton() {
      
// Создаем кнопку "Search with dhamma.gift"
const searchBtn = document.createElement('a');
searchBtn.href = `${dhammaGift}${encodeURIComponent(wordForSearch)}${dgParams}`;

searchBtn.classList.add('open-btn');
searchBtn.style.position = 'fixed';
searchBtn.style.border = 'none';
searchBtn.style.background = '#2D3E50';
searchBtn.style.color = 'white';
searchBtn.style.cursor = 'pointer';
searchBtn.style.width = '30px';
searchBtn.style.height = '30px';
searchBtn.style.borderRadius = '50%';
searchBtn.style.display = 'flex';
searchBtn.style.alignItems = 'center';
searchBtn.style.justifyContent = 'center';
searchBtn.style.textDecoration = 'none';
searchBtn.target = '_blank'; // Открывать ссылку в новой вкладке
searchBtn.style.top = `${event.clientY - 10}px`; // Позиция по Y минус 10 пикселей
searchBtn.style.left = `${event.clientX - 10}px`; // Позиция по X
searchBtn.style.zIndex = '10000'; // Убедимся, что кнопка поверх других элементов
    

// Иконка лупы (аналогичная иконке закрытия)
searchBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="white" style="transform: scaleX(-1);">
        <path d="M505 442.7l-99.7-99.7c28.4-35.3 45.7-79.8 45.7-128C451 98.8 352.2 0 224 0S-3 98.8-3 224s98.8 224 224 224c48.2 0 92.7-17.3 128-45.7l99.7 99.7c6.2 6.2 14.4 9.4 22.6 9.4s16.4-3.1 22.6-9.4c12.5-12.5 12.5-32.8 0-45.3zM224 384c-88.4 0-160-71.6-160-160S135.6 64 224 64s160 71.6 160 160-71.6 160-160 160z"/>
    </svg>
`;

    // Добавляем кнопку в DOM
    document.body.appendChild(searchBtn);

searchBtn.addEventListener('click', () => {
    searchBtn.remove(); // Удаляем кнопку после клика
});
    // Удаляем кнопку через несколько секунд (опционально)
    setTimeout(() => {
        searchBtn.remove();
    }, 1500); // Удалить через 5 секунд

   // Обработчик любого клика на документе
    const handleAnyClick = () => {
        newOpenBtn.remove(); // Удаляем кнопку при любом клике
        document.removeEventListener('click', handleAnyClick); // Удаляем обработчик
    };

    // Добавляем обработчик клика на весь документ
    document.addEventListener('click', handleAnyClick);
}



               const url = `${dictUrl}${encodeURIComponent(cleanedWord)}`;
                   iframe.src = url;

// Обновляем ссылку в кнопке openBtn
const openBtn = document.querySelector('.open-btn');
const wordForSearch = cleanedWord.replace(/'ti/, ''); // Исправил на replace
openBtn.href = `${dhammaGift}${encodeURIComponent(wordForSearch)}${dgParams}`;

if (dictUrl.includes('dicttango')) {
    popup.style.display = 'none';
    overlay.style.display = 'none';
    showSearchButton();
    } else if (dictUrl.includes('searchonly')) {
    popup.style.display = 'none';
    overlay.style.display = 'none';
    showSearchButton();
  }  else {
    popup.style.display = 'block';
    overlay.style.display = 'block';
  //  savePopupState();
}
              
            }
            
        }
    }
});

function getClickedWordWithHTML(element, x, y) {
    const range = document.caretRangeFromPoint(x, y);
    if (!range) return null;

    const parentElement = element.closest('.pli-lang, .rus-lang, .eng-lang, [lang="pi"], [lang="en"], [lang="ru"]');
    if (!parentElement) {
        console.log('Родительский элемент с классом pli-lang не найден.');
        return null;
    }

    // Получаем текст без HTML-тегов
    const fullText = parentElement.textContent;

    // Вычисляем смещение в тексте без учета HTML-тегов
    const globalOffset = calculateOffsetWithHTML(parentElement, range.startContainer, range.startOffset);
    if (globalOffset === -1) {
        console.error('Не удалось вычислить глобальное смещение.');
        return null;
    }

    console.log('Смещение в полном тексте:', globalOffset);

    // Используем обновленное регулярное выражение для поиска слова
    const regex = /[^\s,;.–—!?()]+/g; // Регулярное выражение, игнорирующее пробелы и знаки препинания
    let match;
    while ((match = regex.exec(fullText)) !== null) {
        if (match.index <= globalOffset && regex.lastIndex >= globalOffset) {
            console.log('Найденное слово:', match[0]);
            return match[0];
        }
    }

    console.log('Слово не найдено');
    return null;
}

// Функция для вычисления глобального смещения клика в полном тексте
function calculateOffsetWithHTML(element, targetNode, targetOffset) {
    let offset = 0;
    const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);

    let node;
    while ((node = walker.nextNode())) {
        if (node === targetNode) {
            return offset + targetOffset;
        }
        offset += node.textContent.length;
    }

    console.log('Целевой узел не найден.');
    return -1; // Возвращаем ошибку, если узел не найден
}

// Функция для получения полного текста из элемента, включая все текстовые узлы
function getFullTextFromElement(element) {
    const textNodes = [];
    const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);

    let node;
    while ((node = walker.nextNode())) {
        textNodes.push(node.textContent);
    }

    return textNodes.join(' ').replace(/\s+/g, ' ').trim(); // Удаляем лишние пробелы
}

// Пример обработки клика на элемент
document.addEventListener('click', (event) => {
    const clickedWord = getClickedWordWithHTML(event.target, event.clientX, event.clientY);
    if (clickedWord) {
        console.log('Слово по клику:', clickedWord);
    } else {
        console.log('Слово не определено');
    }
});

// Функция для очистки слова от лишних символов
function cleanWord(word) {
    return word
        .replace(/^[\s'‘—.–।|…"“”]+/, ' ') // Убираем символы в начале, включая пробелы и тире
        .replace(/^[0-9]+/, ' ') 
        .replace(/[\s'‘,—.—–।|"“…:;”]+$/, ' ') // Убираем символы в конце, включая пробелы и тире
        .replace(/[‘'’‘"“””]+/g, "'") // заменяем в середине
        .trim()
        .toLowerCase();
}


   
 </script>
 </body>
 </html>
